CREATE FUNCTION FN_ARREDONDAMENTO_DUCAMPO ( @VALOR NUMERIC(15,2) )  

RETURNS NUMERIC(15,2)  

AS  
BEGIN 

DECLARE @VALOR   NUMERIC(15,2)= 27.00 
DECLARE @DECIMAL NUMERIC(15) 
DECLARE @FATOR   NUMERIC(15,2) 
DECLARE @VALOR_ARREDONDADO NUMERIC(15,2)  

SELECT @DECIMAL = SUBSTRING( CAST( @VALOR AS VARCHAR(20) ) , 
CHARINDEX('.',@VALOR) + 1 , --CHARINDEX CONTA ONDE ESTÁ O PONTO '.' DA VARIAVEL QUE ESTÁ NA POSIÇÃO 3, 3 + 1 ELE PEGA UMA POSIÇÃO APOS O '.'
LEN(@VALOR) --LEN CONTA A QAUNTIDADE DE CARACTERES DA VARIAVEL QUE É 5
- CHARINDEX('.',@VALOR)  )  --ESTE CHARINDEX CONTA E DIZ EM QUAL POSIÇÃO ESTÁ O '.'
SELECT @FATOR = CASE WHEN @DECIMAL / 100 BETWEEN 0.01 AND 0.48 
                     THEN 0.49                      
					 WHEN @DECIMAL / 100 BETWEEN 0.51 AND 0.98 
					 THEN 0.99 ELSE 0 END  
SELECT @VALOR_ARREDONDADO = CASE WHEN @DECIMAL IN(0,50)                  
                                 THEN @VALOR - 0.01    
								 ELSE FLOOR(@VALOR) + @FATOR END   
RETURN @VALOR_ARREDONDADO  END

