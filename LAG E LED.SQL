IF OBJECT_ID('TEMPDB..#TEMP01') IS NOT NULL DROP TABLE #TEMP01

SELECT A.EMPRESA,
       A.MOVIMENTO,
	   SUM(A.VENDA_LIQUIDA) AS VENDA
  INTO #TEMP01
  FROM VENDAS A WITH(NOLOCK)
--WHERE YEAR(A.MOVIMENTO) = 2016
GROUP BY A.EMPRESA,A.MOVIMENTO


SELECT EMPRESA
      ,MOVIMENTO
	  ,VENDA
      ,LAG        (VENDA,1) OVER(PARTITION BY EMPRESA ORDER BY CONVERT(DATE, MOVIMENTO)) AS  "Valor Anterior"  --Valor da última atualização
      ,LEAD       (VENDA,1) OVER(PARTITION BY EMPRESA ORDER BY CONVERT(DATE, MOVIMENTO)) AS  "Valor Futuro"    --Valor da Próxima atualização
      ,FIRST_VALUE(VENDA)   OVER(PARTITION BY EMPRESA ORDER BY CONVERT(DATE, MOVIMENTO)  ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) AS "Primeiro Valor"
      ,LAST_VALUE (VENDA)   OVER(PARTITION BY EMPRESA ORDER BY CONVERT(DATE, MOVIMENTO)  ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) AS "Último Valor"
 FROM #TEMP01 WITH(NOLOCK)
